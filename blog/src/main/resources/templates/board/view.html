<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">
<head>
    <title>ê²Œì‹œê¸€ ë³´ê¸°</title>
</head>
<body>
    <div layout:fragment="content" class="container mt-4">
        <h2 class="mb-4">ê²Œì‹œê¸€ ìƒì„¸ ë³´ê¸°</h2>

        <div class="card p-4 mb-4 shadow-sm">
            <h4 class="mb-3" th:text="${board.title}">ê²Œì‹œê¸€ ì œëª©</h4>
            <p><strong>ì¹´í…Œê³ ë¦¬:</strong> <span th:text="${board.categoryName}">ì¹´í…Œê³ ë¦¬</span></p>
            <p><strong>ì‘ì„±ì:</strong> <span th:text="${board.writer}">ì‘ì„±ì</span></p>
            <p><strong>ì‘ì„±ì¼:</strong> <span th:text="${#dates.format(board.createdAt, 'yyyy-MM-dd HH:mm')}">ì‘ì„±ì¼</span></p>
            <p><strong>ì¡°íšŒìˆ˜:</strong> <span th:text="${board.views}">0</span></p>
            <hr>

            <div class="board-content" th:utext="${board.content}">
                ê²Œì‹œê¸€ ë‚´ìš©
            </div>

            <div class="mt-4">
                <th:block th:if="${session.loginUser != null && session.loginUser.id == board.writer}">
                    <a th:href="@{/board/edit/{id}(id=${board.id})}" class="btn btn-warning btn-sm">ìˆ˜ì •</a>
                    <a th:href="@{/board/delete/{id}(id=${board.id})}"
                       class="btn btn-danger btn-sm"
                       onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ì‚­ì œ</a>
                </th:block>
                <a th:href="@{/board/list}" class="btn btn-secondary btn-sm">ëª©ë¡</a>
            </div>
        </div>

        <div class="card p-4 mb-4 shadow-sm">
            <h5 class="mb-4">ğŸ’¬ ëŒ“ê¸€</h5>
            <div th:if="${comments != null && !comments.empty}">
                <div th:replace="~{board/comment_tree :: commentTree(${comments}, 0)}"></div>
            </div>
            <div th:unless="${comments != null && !comments.empty}" class="text-muted">
                ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
            </div>
        </div>

        <div th:if="${session.loginUser != null}">
            <form th:action="@{/comment/add}" method="post" class="card p-4 shadow-sm">
                <input type="hidden" name="boardId" th:value="${board.id}" />
                <div class="mb-3">
                    <label for="content" class="form-label">ëŒ“ê¸€ ì‘ì„±</label>
                    <textarea name="content" id="content" class="form-control" rows="3" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">ëŒ“ê¸€ ë“±ë¡</button>
            </form>
        </div>

        <div th:unless="${session.loginUser != null}" class="alert alert-light text-muted mt-3 shadow-sm border">
            ëŒ“ê¸€ì„ ì‘ì„±í•˜ë ¤ë©´ <a th:href="@{/member/login}">ë¡œê·¸ì¸</a>ì´ í•„ìš”í•©ë‹ˆë‹¤.
        </div>

        <script th:inline="javascript">
            $(document).on('click', '.reply-btn', function() {
                const commentId = $(this).data('comment-id');
                const replyForm = $('#reply-form-' + commentId);
                const editForm = $('#edit-form-' + commentId);
                
                if (replyForm.length) {
                    $('.reply-form, .edit-form').not(replyForm).hide(); 
                    replyForm.toggle();
                }
            });

            $(document).on('click', '.edit-btn', function() {
                const commentId = $(this).data('comment-id');
                const editForm = $('#edit-form-' + commentId);
                const replyForm = $('#reply-form-' + commentId);
                
                if (editForm.length) {
                    $('.reply-form, .edit-form').not(editForm).hide();
                    editForm.toggle();
                }
            });
        </script>
    </div>
</body>
</html>
